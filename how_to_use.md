# ğŸš€ Terraform ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ EC2 ä½œæˆæ‰‹é †

Terraform ã‚’ä½¿ç”¨ã—ã¦ã€Apache ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç”¨ EC2 ã‚’ä½œæˆãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®æ‰‹é †æ›¸ã§ã™ã€‚

> [!CAUTION]
> **é‡è¦ï¼šå¿…ãšä¸€äººã§å®Ÿæ–½ã—ã¦ãã ã•ã„ï¼ˆåŒæ™‚ä½œæ¥­ç¦æ­¢ï¼‰** > çŠ¶æ…‹ç®¡ç†ãƒ•ã‚¡ã‚¤ãƒ«ã®ç«¶åˆã‚’é˜²ããŸã‚ã€è¤‡æ•°äººã§ã®åŒæ™‚å®Ÿè¡Œã¯å³ç¦ã§ã™ã€‚

---

## ğŸ’» ä½œæ¥­ç’°å¢ƒ

- **ä½œæ¥­ã‚µãƒ¼ãƒãƒ¼**: `2.56.0.205`
- **å¯¾è±¡ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**:
  - `/root/redirect/au,docomo,sbterraform/00_ssm_base` ï¼ˆæœ¬å°Šï¼šåŸå‰‡æ”¾ç½®ï¼‰
  - `/root/redirect/au,docomo,sbterraform/01_redirect_compute` ï¼ˆå®Ÿä½“ï¼šæ“ä½œå¯¾è±¡ï¼‰

---

## ğŸ› ï¸ â‘  AWS ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®è¨­å®š

### ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
`01_redirect_compute/main.tf`

### è¨­å®šå†…å®¹
ä½¿ç”¨ã™ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã€`profile = "aws180"` ãŒç¶­æŒã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

```hcl
provider "aws" {
  # region = "ap-northeast-1"
  region = "us-east-1"  # â† ä½¿ç”¨ã™ã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã™
  # region = "ap-northeast-2"

  profile = "aws180" # âš ï¸ å‰Šé™¤ç¦æ­¢
}

```

---

## ğŸ› ï¸ â‘¡ ä½œæˆã™ã‚‹ EC2ï¼ˆå·æ©Ÿï¼‰ã®æŒ‡å®š

### ç·¨é›†ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
`01_redirect_compute/modules/redirect_ec2/main.tf`

### é‹ç”¨ãƒ«ãƒ¼ãƒ«
locals ãƒ–ãƒ­ãƒƒã‚¯ã® redirect_domains ã«ã¦ã€ä½œæˆã—ãŸã„å·æ©Ÿã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¾ã™ã€‚

```hcl
# ğŸ“„ 01_redirect_compute/modules/redirect_ec2/main.tf
locals {
  redirect_domains = {
    "web-34" = "tune-snowboarding.com",
    "web-38" = "wc4h16cy93xvaj.net",
    "web-39" = "awhmdoqexf.com",
    "web-40" = "agent-miogaginger.com",
    "web-43" = "zpkwtstcucghuy.com",
    "web-48" = "xhykcndqlfsnsk.com",
    # "web-51" = "27pckzcv8pccn.com", # è¿½åŠ ã—ãŸã„å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã™
  }
}
```

- è¿½åŠ : æ–°ã—ã„å·æ©Ÿã®ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã‚’å¤–ã—ã¦ terraform apply  

- å‰Šé™¤: è©²å½“è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ terraform apply  

- åˆ¶é™: ä¸€éƒ¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ãŒã‚ã‚‹ãŸã‚ã€3ã€œ6å°ãšã¤ ã®ä½œæˆã‚’æ¨å¥¨ã—ã¾ã™ã€‚  


---

## ğŸš€ â‘¢ å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

`01_redirect_compute` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †ã«å®Ÿè¡Œã—ã¾ã™ã€‚

1. **åˆæœŸåŒ–**
   ```bash
   terraform init
   ```

2. **å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèª**
   ```bash
   terraform plan
   ```

3. **åæ˜ **
   ```bash
   terraform apply
   ```

---

## ğŸ§¹ â‘£ ä¸è¦ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤
`01_redirect_compute` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’é †ã«å®Ÿè¡Œã—ã¾ã™ã€‚  
åˆ¥ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¸ç§»è¡Œã—ãŸå ´åˆãªã©ã€å‰å›ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ãŒä¸è¦ã«ãªã£ãŸéš›ã¯å¿…ãšå‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ 

   ```bash
   terraform destroy
   ```


